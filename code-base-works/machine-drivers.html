<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-code-base-works/machine-drivers">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.22">
<title data-rh="true">Machine Drivers | Rancher UI DevKit</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://rancher.github.io/dashboard/code-base-works/machine-drivers"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Machine Drivers | Rancher UI DevKit"><meta data-rh="true" name="description" content="A machine driver consists of:"><meta data-rh="true" property="og:description" content="A machine driver consists of:"><link data-rh="true" rel="icon" href="/dashboard/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://rancher.github.io/dashboard/code-base-works/machine-drivers"><link data-rh="true" rel="alternate" href="https://rancher.github.io/dashboard/code-base-works/machine-drivers" hreflang="en"><link data-rh="true" rel="alternate" href="https://rancher.github.io/dashboard/code-base-works/machine-drivers" hreflang="x-default"><link rel="stylesheet" href="/dashboard/assets/css/styles.4efd166e.css">
<link rel="preload" href="/dashboard/assets/js/runtime~main.b260a526.js" as="script">
<link rel="preload" href="/dashboard/assets/js/main.6235d173.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/dashboard/"><div class="navbar__logo"><img src="/dashboard/img/rancher-logo.svg" alt="Rancher Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/dashboard/img/rancher-logo.svg" alt="Rancher Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">UI DevKit</b></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/dashboard/getting-started/concepts">Docs</a><a href="https://rancher.github.io/storybook/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Components &amp; Design kit<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/dashboard/getting-started/concepts">Getting Stated</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/dashboard/guide/build-for-container-registry">Guide</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/dashboard/code-base-works/api-resources-and-schemas">How code base works</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/dashboard/code-base-works/api-resources-and-schemas">API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/dashboard/code-base-works/auth-providers">Auth Providers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/dashboard/code-base-works/auth-sessions-and-tokens">Auth Sessions and Tokens</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/dashboard/code-base-works/cluster-management-resources">Cluster Management Resources</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/dashboard/code-base-works/directory-structure">Directory Structure</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/dashboard/code-base-works/helm-chart-apps">Helm Chart Apps</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/dashboard/code-base-works/keyboard-shortcuts">Keyboard shortcuts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/dashboard/code-base-works/machine-drivers">Machine Drivers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/dashboard/code-base-works/performance">Performance</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/dashboard/fossa">Fossa</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/dashboard/on-screen-text-and-translations">On-screen Text and Translations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/dashboard/products-and-navigation">Products and Navigation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/dashboard/server-side-rendering">Server-side Rendering</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/dashboard/sortable-table">Sortable Table</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/dashboard/style">Style</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/dashboard/terminology">Terminology</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/dashboard/testing/stress-test">Testing</a></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/dashboard/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">How code base works</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Machine Drivers</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Machine Drivers</h1><p>A machine driver consists of:</p><ul><li>The actual driver run inside the server container.  This can be built-in to <code>rancher-machine</code> or loaded as an external binary.</li><li>A component to create &amp; edit the <code>cloud-credential</code> for the provider, which stores the user&#x27;s auth information to talk to the provider API.</li><li>A component to create &amp; edit the <code>machine-config</code>, which describes the size, location, and other options for a particular machine to be deployed to the provider.</li><li>An optional <code>model</code> to override properties of a generic <code>machine-template</code> object with details specific to this provider.</li><li>An optional <code>store</code> to facilitate communication with the provider&#x27;s API and caching of information retrieved from it.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="driver-binary">Driver binary<a class="hash-link" href="#driver-binary" title="Direct link to heading">​</a></h2><p>To tell Rancher about a new driver, go to Cluster Management -&gt; Drivers -&gt; Node Drivers -&gt; Add Node Driver.  Set the URL the binary should be downloaded from.  If the UI will need to communicate with an API to show options (e.g getting data from <code>api.mycloudprovider.com</code>), add it to the list of Whitelist Domains.  Click Create to save.  The driver is downloaded and loaded and becomes available in the UI using all the generic driver support.  This just lists all the fields that the driver says it has and makes some guesses about likely sounding names.  The user ultimately has to figure out which ones are required or important and set those.  To improve on that, continue reading.</p><p>For more advanced control, the machine driver custom resource supports several annotations:</p><table><thead><tr><th>Key</th><th>Value</th></tr></thead><tbody><tr><td>publicCredentialFields</td><td>Fields that are considered &quot;public&quot; information and ok to display in cleartext for detail screens</td></tr><tr><td>privateCredentialFields</td><td>Fields that are private information that should be stored as a secret</td></tr><tr><td>optionalCredentialFields</td><td>Fields that are related to the credential, but are optional for the user to fill out</td></tr><tr><td>passwordFields</td><td>Fields that should be displayed as type=&quot;password&quot; bullets instead of cleartext</td></tr><tr><td>defaults</td><td>Default values to set which the user may override</td></tr></tbody></table><p>Each has a value that is a comma-separated list of field names.  <code>defaults</code> are comma-separated, then colon-separated for key and value (e.g. <code>foo:bar,baz:42</code>).  The annotations become information in API schemas, which the generic UI support uses to show better information.</p><p>The standard drivers included in Rancher and their options are defined <a href="https://github.com/rancher/rancher/blob/release/v2.6/pkg/data/management/machinedriver_data.go" target="_blank" rel="noopener noreferrer">here</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="cloud-credential">Cloud Credential<a class="hash-link" href="#cloud-credential" title="Direct link to heading">​</a></h2><p>Cloud Credentials store the username &amp; password, or other similar information, needed to talk to a particular provider.  There is typically a 1-to-1 mapping of cloud credentials to drivers.  If one provider (e.g. Amazon) has both a <em>Machine</em> driver for RKE (using EC2) and a <em>Cluster</em> driver for Kontainer Engine (using EKS) then you can and should use a single shared type of credential (e.g. <code>aws</code>) for both.</p><p>The cloud credential component lives in the top-level <code>cloud-credential</code> directory in the repo.  The file should be named the same as the driver, in all lowercase (e.g. <code>cloud-credential/digitalocean.vue</code>).</p><p>If there is a reason to rename it or map multiple drivers to the same credential, configure that in the <a href="/shell/store/plugins.js">plugins store</a>.  There is also other info in there about how guesses are taken on what each field is for and how it should be displayed.  These can be customized for your driver by importing and calling <code>configureCredential()</code> and <code>mapDriver()</code>.</p><p>Create a component which displays each field that is relevant to authentication and lets the user configure them.  Only the actual auth fields themselves, the rest of configuring the name, description, save buttons, etc is handled outside of the credential component.</p><p>Your component should emit a <code>validationChanged</code> event every time a value changes.  It should also (but doesn&#x27;t <em>have to</em> implement a <code>test()</code> method.  This may be asynchronous, and should make an API call or similar to see if the provided credentials work.  Return <code>true</code> if they&#x27;re ok and <code>false</code> otherwise.  When provided, this is called before saving and the user won&#x27;t be able to save until their input causes you return <code>true</code>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="machine-config">Machine Config<a class="hash-link" href="#machine-config" title="Direct link to heading">​</a></h2><p>Similar to the Cloud Credential component, the Machine Config component should display just controls for the fields on the driver that are relevant to the configuration of the machine to be created.  The machine pool name, saving, etc is handled outside of your component.  You probably want to use <code>fetch()</code> to load some info from the provider&#x27;s API (e.g. list of regions or instance types).</p><p>It should live in the top-level <code>machine-config</code> directory, again named the same as the driver and lowercase (e.g. <code>machine-config/digitalocean.vue</code>).</p><p>The selected cloud credential ID is available as a <code>credentialId</code> prop.  You will always know that ID, and can use it to make API calls (see <!-- -->[#api-calls]<!-- --> below), but <strong>must not</strong> rely on being able to actually retrieve the cloud credential model corresponding to it.  Users with lesser permissions may be able to edit a cluster, but not have permission to see the credential being used to manage it.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="model">Model<a class="hash-link" href="#model" title="Direct link to heading">​</a></h2><p>Each cluster has one or more Machine Templates, which specify to create a particular number of machines using a specified Machine Config + Cloud Credential.  Basic information about the template is shown later on detail screens, such as the machine size and location.  This is done by providing a model class for your driver&#x27;s template and overriding methods.</p><p>Your model should be called <code>models/rke-machine.cattle.io.[your driver in lowercase]template.js</code> (corresponding to the schema that shows up once the driver is installed).  It should extend the generic MachineTemplate and override methods as appropriate:</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">MachineTemplate</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;./rke-machine.cattle.io.machinetemplate&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">default</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">MyDriverMachineTemplate</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">extends</span><span class="token plain"> </span><span class="token class-name">MachineTemplate</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">get</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">provider</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;mydriver&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">get</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">providerLocation</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">spec</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">template</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">spec</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">zone</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">get</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">providerSize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">spec</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">template</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">spec</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">instanceType</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="api-calls">API Calls<a class="hash-link" href="#api-calls" title="Direct link to heading">​</a></h2><p>Rancher includes a <a href="https://github.com/rancher/rancher/blob/release/v2.6/pkg/httpproxy/proxy.go" target="_blank" rel="noopener noreferrer">proxy</a> that can be used to make requests to third-party domains (like a cloud provider&#x27;s API) without requiring that the other end supports CORS or other browser shenanigans.  Send requests to <code>/meta/proxy/example.com/whatever/path/you/want</code> and the request will be made from the Rancher server and proxied back to you.</p><p>TLS and port 443 are assumed.  Add a port after the hostname to change the port (<code>example.com:1234</code>).  For plain HTTP, first stop and consider the chain of life decisions which have led you to this point. Then if you still think you need that, use <code>/meta/proxy/http:/example.com:1234</code> (note one slash after <code>http:</code>, not two).  The hostname must be included in the whitelist defined in global settings, or in the configuration for an active node driver.  If if isn&#x27;t your request will be denied.  (This prevents a malicious (non-admin) user from abusing the Rancher server as an arbitrary HTTP proxy or reach internal IPs/names that the server can reach directly but the user can&#x27;t from the outside.)</p><p>The rest of the path and query string are sent to the target host as you&#x27;d expect.</p><p>Normal headers are copied from your request and sent to the target.  There are some exceptions for sensitive fields like the user&#x27;s rancher cookies or saved basic auth creds which will not be copied.  If you send an <code>X-Api-Cookie-Header</code>, its value will be sent as the normal <code>Cookie</code> to the target.  If you send <code>X-API-Auth-Header</code>, that will be sent out as the normal <code>Authorization</code>.</p><p>But normally you want to make a request using a Cloud Credential as the authorization, without knowing what the secret values in that credential are.  You ask for this by sending an <code>X-Api-CattleAuth-Header</code> header.  The value of the header specifies what credential Id to use, and a <a href="https://github.com/rancher/rancher/blob/release/v2.6/pkg/httpproxy/sign.go" target="_blank" rel="noopener noreferrer">signer</a> which describes how that credential should be injected into the request.  Common options include <code>awsv4</code> (Amazon&#x27;s complicated HMAC signatures), <code>bearer</code>, <code>basic</code>, and <code>digest</code>.  For example if you send <code>X-Api-CattleAuth-Header: Basic credId=someCredentialId usernameField=user passwordField=pass</code>, Rancher will retrieve the credential with id <code>someCredentialId</code>, read the values of the <code>user</code> and <code>pass</code> fields from it and add the header <code>Authorization: Basic &lt;base64(user + &quot;:&quot; + pass)&gt;</code> to the proxied request for you.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="store">Store<a class="hash-link" href="#store" title="Direct link to heading">​</a></h2><p>If you have several different API calls to make or expensive information that can be cached after it&#x27;s retrieved once, consider making a <code>store</code> with getters and actions to handle making your API calls and managing the caching.  Most of the standard built-in drivers have these.</p><p>For more complicated providers (e.g. AWS) you can also consider importing their Javascript SDK and using their client to make calls.  But unless there is an extension point to manipulate the request before they send it, you&#x27;ll probably have to monkey patch their client to get the <code>X-Api-CattleAuth-Header</code> injected and the request sent through the proxy instead of direct to them.  The SDK should also be dynamically <code>import(&#x27;…&#x27;)</code>ed as needed at runtime so it&#x27;s not loaded all the time.  Regular <code>import … as …;</code> at the top of the file will become part of the basic app bundle js that&#x27;s always loaded and has to be downloaded before the page can render.  <code>store/aws.js</code> has examples of all of this.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2022-08-22T14:30:44.000Z">Aug 22, 2022</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/dashboard/code-base-works/keyboard-shortcuts"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Keyboard shortcuts</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/dashboard/code-base-works/performance"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Performance</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#driver-binary" class="table-of-contents__link toc-highlight">Driver binary</a></li><li><a href="#cloud-credential" class="table-of-contents__link toc-highlight">Cloud Credential</a></li><li><a href="#machine-config" class="table-of-contents__link toc-highlight">Machine Config</a></li><li><a href="#model" class="table-of-contents__link toc-highlight">Model</a></li><li><a href="#api-calls" class="table-of-contents__link toc-highlight">API Calls</a></li><li><a href="#store" class="table-of-contents__link toc-highlight">Store</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__links text--center"><div class="footer__links"><a href="https://slack.rancher.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><span class="footer__link-separator">·</span><a href="https://github.com/rancher/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Rancher. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks.</div></div></div></footer></div>
<script src="/dashboard/assets/js/runtime~main.b260a526.js"></script>
<script src="/dashboard/assets/js/main.6235d173.js"></script>
</body>
</html>